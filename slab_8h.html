<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libusual: usual/slab.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>usual/slab.h File Reference</h1>  </div>
</div>
<div class="contents">

<p>Slab allocator for same-size objects.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#a7ec03b75ef243cbedcfc9db61987381f">slab_init_fn</a> )(void *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signature for object init function.  <a href="#a7ec03b75ef243cbedcfc9db61987381f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#a7feec873245b77506179b6d79364c865">slab_stat_fn</a> )(void *arg, const char *slab_name, unsigned size, unsigned free, unsigned total)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signature for stat info callback.  <a href="#a7feec873245b77506179b6d79364c865"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct Slab *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#ab28c082ddc68873e258018f73543c74c">slab_create</a> (const char *name, unsigned obj_size, unsigned align, <a class="el" href="slab_8h.html#a7ec03b75ef243cbedcfc9db61987381f">slab_init_fn</a> init_func, <a class="el" href="struct_cx_mem.html">CxMem</a> *cx)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create new slab context for specific size.  <a href="#ab28c082ddc68873e258018f73543c74c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#a3aaf7bd6e93c63526ec768f9170e21eb">slab_destroy</a> (struct Slab *slab)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free whole context.  <a href="#a3aaf7bd6e93c63526ec768f9170e21eb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#aa4015e4bd5d1b54774b686388d31d451">slab_alloc</a> (struct Slab *slab) _MALLOC _MUSTCHECK</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate single object from slab cache.  <a href="#aa4015e4bd5d1b54774b686388d31d451"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#a800fee551b80e8e0b7e4afa59e289be3">slab_free</a> (struct Slab *slab, void *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release single object back.  <a href="#a800fee551b80e8e0b7e4afa59e289be3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#abd2cba6e969cb9c548ca3b2a9ed20d3a">slab_total_count</a> (const struct Slab *slab)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return sum of free and used objects.  <a href="#abd2cba6e969cb9c548ca3b2a9ed20d3a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#a4cd060376fd0a9bbbce9294e1e66371c">slab_free_count</a> (const struct Slab *slab)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return number of free objects in cache.  <a href="#a4cd060376fd0a9bbbce9294e1e66371c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#af35973b5d6eadd9dd290ee6500ff877c">slab_active_count</a> (const struct Slab *slab)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return number of used objects.  <a href="#af35973b5d6eadd9dd290ee6500ff877c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slab_8h.html#ab6ca42985a42d1a4942ec56c26c6735e">slab_stats</a> (<a class="el" href="slab_8h.html#a7feec873245b77506179b6d79364c865">slab_stat_fn</a> cb_func, void *cb_arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Run stat info callback on all slabs.  <a href="#ab6ca42985a42d1a4942ec56c26c6735e"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Slab allocator for same-size objects. </p>
<p>Basic behaviour:</p>
<ul>
<li>On each alloc initializer is called.</li>
<li>if init func is not given, memset() is done</li>
<li>init func gets either zeroed obj or old obj from _free(). 'struct List' on obj start is non-zero.</li>
</ul>
<p>ATM custom 'align' larger than malloc() alignment does not work. </p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a7ec03b75ef243cbedcfc9db61987381f"></a><!-- doxytag: member="slab.h::slab_init_fn" ref="a7ec03b75ef243cbedcfc9db61987381f" args=")(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* <a class="el" href="slab_8h.html#a7ec03b75ef243cbedcfc9db61987381f">slab_init_fn</a>)(void *obj)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Signature for object init function. </p>

</div>
</div>
<a class="anchor" id="a7feec873245b77506179b6d79364c865"></a><!-- doxytag: member="slab.h::slab_stat_fn" ref="a7feec873245b77506179b6d79364c865" args=")(void *arg, const char *slab_name, unsigned size, unsigned free, unsigned total)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* <a class="el" href="slab_8h.html#a7feec873245b77506179b6d79364c865">slab_stat_fn</a>)(void *arg, const char *slab_name, unsigned size, unsigned free, unsigned total)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Signature for stat info callback. </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab28c082ddc68873e258018f73543c74c"></a><!-- doxytag: member="slab.h::slab_create" ref="ab28c082ddc68873e258018f73543c74c" args="(const char *name, unsigned obj_size, unsigned align, slab_init_fn init_func, CxMem *cx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct Slab* slab_create </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>obj_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>align</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="slab_8h.html#a7ec03b75ef243cbedcfc9db61987381f">slab_init_fn</a>&nbsp;</td>
          <td class="paramname"> <em>init_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_cx_mem.html">CxMem</a> *&nbsp;</td>
          <td class="paramname"> <em>cx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create new slab context for specific size. </p>

</div>
</div>
<a class="anchor" id="a3aaf7bd6e93c63526ec768f9170e21eb"></a><!-- doxytag: member="slab.h::slab_destroy" ref="a3aaf7bd6e93c63526ec768f9170e21eb" args="(struct Slab *slab)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slab_destroy </td>
          <td>(</td>
          <td class="paramtype">struct Slab *&nbsp;</td>
          <td class="paramname"> <em>slab</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free whole context. </p>

</div>
</div>
<a class="anchor" id="aa4015e4bd5d1b54774b686388d31d451"></a><!-- doxytag: member="slab.h::slab_alloc" ref="aa4015e4bd5d1b54774b686388d31d451" args="(struct Slab *slab) _MALLOC _MUSTCHECK" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* slab_alloc </td>
          <td>(</td>
          <td class="paramtype">struct Slab *&nbsp;</td>
          <td class="paramname"> <em>slab</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate single object from slab cache. </p>

</div>
</div>
<a class="anchor" id="a800fee551b80e8e0b7e4afa59e289be3"></a><!-- doxytag: member="slab.h::slab_free" ref="a800fee551b80e8e0b7e4afa59e289be3" args="(struct Slab *slab, void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slab_free </td>
          <td>(</td>
          <td class="paramtype">struct Slab *&nbsp;</td>
          <td class="paramname"> <em>slab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release single object back. </p>

</div>
</div>
<a class="anchor" id="abd2cba6e969cb9c548ca3b2a9ed20d3a"></a><!-- doxytag: member="slab.h::slab_total_count" ref="abd2cba6e969cb9c548ca3b2a9ed20d3a" args="(const struct Slab *slab)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int slab_total_count </td>
          <td>(</td>
          <td class="paramtype">const struct Slab *&nbsp;</td>
          <td class="paramname"> <em>slab</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return sum of free and used objects. </p>

</div>
</div>
<a class="anchor" id="a4cd060376fd0a9bbbce9294e1e66371c"></a><!-- doxytag: member="slab.h::slab_free_count" ref="a4cd060376fd0a9bbbce9294e1e66371c" args="(const struct Slab *slab)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int slab_free_count </td>
          <td>(</td>
          <td class="paramtype">const struct Slab *&nbsp;</td>
          <td class="paramname"> <em>slab</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return number of free objects in cache. </p>

</div>
</div>
<a class="anchor" id="af35973b5d6eadd9dd290ee6500ff877c"></a><!-- doxytag: member="slab.h::slab_active_count" ref="af35973b5d6eadd9dd290ee6500ff877c" args="(const struct Slab *slab)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int slab_active_count </td>
          <td>(</td>
          <td class="paramtype">const struct Slab *&nbsp;</td>
          <td class="paramname"> <em>slab</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return number of used objects. </p>

</div>
</div>
<a class="anchor" id="ab6ca42985a42d1a4942ec56c26c6735e"></a><!-- doxytag: member="slab.h::slab_stats" ref="ab6ca42985a42d1a4942ec56c26c6735e" args="(slab_stat_fn cb_func, void *cb_arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slab_stats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="slab_8h.html#a7feec873245b77506179b6d79364c865">slab_stat_fn</a>&nbsp;</td>
          <td class="paramname"> <em>cb_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>cb_arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Run stat info callback on all slabs. </p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
