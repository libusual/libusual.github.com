<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>antimake.mk(5)</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>antimake.mk(5)</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<div class="paragraph"><p>antimake - Minimal Automake syntax on plain GNU Make</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph"><p>Antimake makes possible to use GNU Automake conventions
to describe builds in ordinary Makefiles for GNU Make.</p></div>
<div class="paragraph"><p>It&#8217;s main abstractions are target lists and target variables.
Target list describes target type and where to install.
Target variables give source files and additional flags for build.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_example">EXAMPLE</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt># target list
bin_PROGRAMS = prog

# target variables for 'prog'
prog_SOURCES = prog.c prog.h
prog_LDADD = libutil.a

# target list
noinst_LIBRARIES = libutil.a

# target variables for 'libutil.a'
libutil_a_SOURCES = util.c util.h

# load Antimake
include antimake.mk</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_terminology">Terminology</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
Primary
</dt>
<dd>
<p>
  target type, describes how to build and install particular type of targets.
</p>
</dd>
<dt class="hdlist1">
Target
</dt>
<dd>
<p>
  a file that needs to be built and/or installed.
</p>
</dd>
<dt class="hdlist1">
Distribute
</dt>
<dd>
<p>
  Include file in source .tar.gz.  Non-distributed files are skipped
  when building .tar.gz and are cleaned during <tt>make distclean</tt>.
</p>
</dd>
<dt class="hdlist1">
Source
</dt>
<dd>
<p>
  Source files are files that appear in <tt>..._SOURCES</tt> per-target variable.
  They are distributed by default.  They may or may not result in object files.
  It&#8217;s fine to put both <tt>.h</tt> and <tt>.c</tt> files into _SOURCES.
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_target_lists">TARGET LISTS</h2>
<div class="sectionbody">
<div class="paragraph"><p>Target lists are variables that contain file names that need to be
built and installed.  They are specially named so that the name also describes how they
are built, how and where they will be installed.</p></div>
<div class="paragraph"><p>The target list name contains 3 parts, separated with underscore, in following order:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Optional flags.  Flags are: <tt>nodist</tt>, <tt>dist</tt>, <tt>nobase</tt>, <tt>base</tt>.  (Default: <tt>base</tt>, <tt>nodist</tt>)
</p>
</li>
<li>
<p>
Destination directory name.  Destination directory called <strong>bin</strong> actual
   location is stored in Make variable <tt>$(bindir)</tt>.  Some common values:
   <tt>bin</tt>, <tt>lib</tt>, <tt>include</tt>.   There are more and the list can be extended.
   Special name <tt>noinst</tt> means the target file should not be installed.
</p>
</li>
<li>
<p>
Target type, also called "primary".   This will describe how the target
   needs to be built.  Common values: <tt>PROGRAMS</tt>, <tt>LIBRARIES</tt>, <tt>DATA</tt>
</p>
</li>
</ol></div>
<div class="paragraph"><p>For details, what the various values mean, see next sections.</p></div>
<div class="listingblock">
<div class="title">Examples:</div>
<div class="content">
<pre><tt>bin_PROGRAMS = prog1 prog2
# flags: base, nodist
# dest: $(bindir)
# type: PROGRAMS

noinst_LIBRARIES = lib1.a lib2.a
# flags: base, nodist
# dest: noinst
# type: LIBRARIES

nobase_dist_doc_DATA = docs/README
# flags: dist, nobase
# dest: $(docdir)/docs
# type: DATA</tt></pre>
</div></div>
<div class="sect2">
<h3 id="_primaries">Primaries</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>PROGRAMS</tt>
</dt>
<dd>
<p>
  executable programs, linked together from objects built from source files
</p>
</dd>
<dt class="hdlist1">
<tt>LIBARIES</tt>
</dt>
<dd>
<p>
  static libraries, linked together from objects built from source files
</p>
</dd>
<dt class="hdlist1">
<tt>LTLIBRARIES</tt>
</dt>
<dd>
<p>
  dynamic or static libraries, linked together from objects built from source files
</p>
</dd>
<dt class="hdlist1">
<tt>HEADERS</tt>
</dt>
<dd>
<p>
  header files, no default build method, the target files have <tt>dist</tt> flag by default.
</p>
</dd>
<dt class="hdlist1">
<tt>MANS</tt>
</dt>
<dd>
<p>
  man pages, no default build method, installed into manX subdir.
</p>
</dd>
<dt class="hdlist1">
<tt>SCRIPTS</tt>
</dt>
<dd>
<p>
  scripts, executable file, no default build method
</p>
</dd>
<dt class="hdlist1">
<tt>DATA</tt>
</dt>
<dd>
<p>
  data, non-executable file, no default build method
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_target_list_flags">Target list flags</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>dist</tt>
</dt>
<dd>
<p>
  The target should be distributed with other sources.
  Default for <tt>HEADERS</tt> type, others have <tt>nodist</tt> by default.
</p>
</dd>
<dt class="hdlist1">
<tt>nodist</tt>
</dt>
<dd>
<p>
  Target is not distributed and should be cleaned with distclean.
  Default for all primaries, except <tt>HEADERS</tt>.
</p>
</dd>
<dt class="hdlist1">
<tt>base</tt>
</dt>
<dd>
<p>
  On install relative path is ignored, all files
  end up in destination directory.  Always default.
</p>
</dd>
<dt class="hdlist1">
<tt>nobase</tt>
</dt>
<dd>
<p>
  On install relative path is kept.  Eg: if <tt>includedir=/usr/include</tt>
  then <tt>nobase_include_HEADERS=mylib/common.h</tt>
  is installed to <tt>/usr/include/mylib/common.h</tt>.
</p>
</dd>
<dt class="hdlist1">
<tt>noinst</tt>
</dt>
<dd>
<p>
  Target is built as part of build process, but is not installed.
</p>
</dd>
<dt class="hdlist1">
<tt>EXTRA</tt>
</dt>
<dd>
<p>
  Targets in such list are not built, nor installed.
  Useful to make sure that sources for dynamically configured targets
  will end up in source tarball.  Unlike other target list ariables,
  <tt>EXTRA_&lt;primary&gt;</tt> may contain targets already defined in other
  target lists, they will be filtered out from this list then.
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_target_variables">Target variables</h2>
<div class="sectionbody">
<div class="paragraph"><p>Only big targets take additional variables: <tt>PROGRAMS</tt>/<tt>LIBRARIES</tt>/<tt>LTLIBRARIES</tt>.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>&lt;tgt&gt;_SOURCES</tt>
</dt>
<dd>
<p>
    All source files, *.c *.h *.cpp *.hpp.
</p>
</dd>
<dt class="hdlist1">
<tt>nodist_&lt;tgt&gt;_SOURCES</tt>
</dt>
<dd>
<p>
    Source files that should not be distributed.
</p>
</dd>
<dt class="hdlist1">
<tt>EXTRA_&lt;tgt&gt;_SOURCES</tt>
</dt>
<dd>
<p>
    In case tgt_SOURCES is dynamic, here is non-dynamic
    list of sources for distribution.  Only dynamic sources
    need to be listed here.
</p>
</dd>
<dt class="hdlist1">
<tt>&lt;tgt&gt;_DEPENDENCIES</tt>
</dt>
<dd>
<p>
    Add dependencies that need to be build before target build will start.
</p>
</dd>
<dt class="hdlist1">
<tt>&lt;tgt&gt;_CFLAGS</tt>, <tt>&lt;tgt&gt;_CPPFLAGS</tt>, <tt>&lt;tgt&gt;_LDFLAGS</tt>, <tt>&lt;tgt&gt;_LIBTOOLFLAGS</tt>
</dt>
<dd>
<p>
    Override corresponging AM_xx variable
</p>
</dd>
<dt class="hdlist1">
<tt>&lt;tgt&gt;_LDADD</tt>
</dt>
<dd>
<p>
    Add dependencies that are used during linking.
    For PROGRAMS only.
    They will be added to linker command line.
</p>
</dd>
<dt class="hdlist1">
<tt>&lt;tgt&gt;_LIBADD</tt>
</dt>
<dd>
<p>
    Add dependencies that are used during linking.
    For LIBRARIES/LTLIBRARIES only.
    They will be added to linker command line.
</p>
</dd>
<dt class="hdlist1">
<tt>&lt;tgt&gt;_AR</tt>
</dt>
<dd>
<p>
    Overrides $(AR) $(ARFLAGS).
    For LIBRARIES only.
</p>
</dd>
</dl></div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre><tt>bin_PROGRAMS = prog
prog_SOURCE = main.c util.c util.h
prog_CFLAGS = $(GTK_CFLAGS)
prog_LDADD = $(GTK_LIBS)</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_global_variables">Global variables</h2>
<div class="sectionbody">
<div class="paragraph"><p>They can be set before <tt>antimake.mk</tt> inclusion to change
build behaviour.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
EXTRA_DIST
</dt>
<dd>
<p>
        Additional files to include in source archive.
</p>
</dd>
<dt class="hdlist1">
CLEANFILES
</dt>
<dd>
<p>
        Additional files to <tt>make clean</tt>.
</p>
</dd>
<dt class="hdlist1">
DISTCLEANFILES
</dt>
<dd>
<p>
        Additional files to <tt>make distclean</tt>.
</p>
</dd>
<dt class="hdlist1">
MAINTAINERCLEANFILES
</dt>
<dd>
<p>
        Additional files to <tt>make maintainer-clean</tt>.
</p>
</dd>
<dt class="hdlist1">
SUBDIRS
</dt>
<dd>
<p>
        Subdirectories of current directory where Make
        needs to be recursively launched.  If subdirectory
        <tt>Makefile</tt> is Antimake-base, it should set <tt>SUBLOC</tt>.
</p>
</dd>
<dt class="hdlist1">
SUBLOC
</dt>
<dd>
<p>
        Current diretory location in overall source tree.
        This can stay unset in top directory.  Needed for
        subdirectiories entered with <tt>SUBDIRS</tt> to find
        its position in source tree.
</p>
</dd>
<dt class="hdlist1">
DIST_SUBDIRS
</dt>
<dd>
<p>
        Subdirs that only <tt>make dist</tt>, <tt>make distclean</tt> and <tt>make maintainer-clean</tt>
        will enter.
</p>
</dd>
<dt class="hdlist1">
EMBED_SUBDIRS
</dt>
<dd>
<p>
        Subdirectories that are built non-recursively: they need to contain <tt>Makefile.am</tt>
        that contains makefile-fragment with Antimake syntax
        that describes local targets using relative filenames.
        The fragment is included in main makefile and file
        and variable names are converted and merged with top-level targets.
</p>
</dd>
<dt class="hdlist1">
AM_FEATURES
</dt>
<dd>
<p>
        List of extensions to load.  Extensions are Makefile fragments
        that are loaded before actual rules are generated, so they
        can change or add targets.
</p>
</dd>
</dl></div>
<div class="sect2">
<h3 id="_more_details_on_embed_subdirs">More details on EMBED_SUBDIRS</h3>
<div class="paragraph"><p>It acts like <tt>include $(dir)/Makefile.am</tt> for each directory, except it converts
file and variable names.  Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>Makefile:
  EMBED_SUBDIRS = src

src/Makefile.am:
  bin_PROGRAMS = hello
  hello_SOURCES = main.c
  hello_CPPFLAGS = -I./include</tt></pre>
</div></div>
<div class="paragraph"><p>Conversion results as if top-level <tt>Makefile</tt> had contained following rows:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>bin_PROGRAMS += src/hello
src_hello_SOURCES = src/main.c
src_hello_CPPFLAGS = -I./src/include</tt></pre>
</div></div>
<div class="paragraph"><p>Variables, where file names are converted:</p></div>
<div class="ulist"><ul>
<li>
<p>
SUBDIRS, DIST_SUBDIRS, EMBED_SUBDIRS
</p>
</li>
<li>
<p>
DISTFILES, CLEANFILES, DISTCLEANFILES, MAINTAINERCLEANFILES
</p>
</li>
<li>
<p>
target lists
</p>
</li>
<li>
<p>
&lt;tgt&gt;_SOURCES, &lt;tgt&gt;_LDADD, &lt;tgt&gt;_LIBADD
</p>
</li>
</ul></div>
<div class="paragraph"><p>Variables, where -L and -I flags are converted:</p></div>
<div class="ulist"><ul>
<li>
<p>
&lt;tgt&gt;_CFLAGS
</p>
</li>
<li>
<p>
&lt;tgt&gt;_CPPFLAGS
</p>
</li>
<li>
<p>
&lt;tgt&gt;_LDFLAGS
</p>
</li>
</ul></div>
<div class="paragraph"><p>Makefile should be written in a way that those conversions
would be enough.</p></div>
</div>
<div class="sect2">
<h3 id="_global_variables_for_current_location">Global variables for current location</h3>
<div class="ulist"><ul>
<li>
<p>
srcdir, builddir - relative path to source dir and build dir.
</p>
</li>
<li>
<p>
top_srcdir, top_builddir - relative path to top-level source and build dir.
</p>
</li>
<li>
<p>
abs_srcdir, abs_builddir - absolute path to source and build dir
</p>
</li>
<li>
<p>
abs_top_srcdir, abs_top_builddir - absolute path to top-level source and build dir
</p>
</li>
<li>
<p>
nosub_top_srcdir, nosub_top_builddir - relative path from top of builddir to srcdir and builddir.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_global_variables_that_target_can_override">Global variables that target can override</h3>
<div class="ulist"><ul>
<li>
<p>
AM_CPPFLAGS
</p>
</li>
<li>
<p>
AM_CFLAGS
</p>
</li>
<li>
<p>
AM_LDFLAGS
</p>
</li>
<li>
<p>
AM_LIBTOOLFLAGS
</p>
</li>
<li>
<p>
AM_DEFS
</p>
</li>
<li>
<p>
AM_MAKEFLAGS
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_global_variables_from_autoconf">Global variables from autoconf</h3>
<div class="paragraph"><p>These variables come usually from autoconf,
but also have reasonable defaults:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>CC, DEFS, CPPFLAGS, CFLAGS, LDFLAGS, LIBS,
LIBTOOL, LIBTOOLFLAGS, AR, ARFLAGS, RANLIB,
CXX, CXXFLAGS, INSTALL, MKDIR_P, LN_S</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_global_variables_for_extending_antimake">Global variables for extending Antimake</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
AM_DIST_DEFAULT
</dt>
<dd>
<p>
        Default format(s) for <tt>make dist</tt> target.  One or more of:
        <tt>gzip</tt>, <tt>bzip2</tt>, <tt>xz</tt>, <tt>zip</tt>.  Default: <tt>gzip</tt>.
</p>
</dd>
<dt class="hdlist1">
AM_DESTINATIONS
</dt>
<dd>
<p>
        Additional directory names to consider as valid
        destinations.  Expects corresponding <tt>dir</tt>-variable to be set.
</p>
</dd>
<dt class="hdlist1">
AM_SMALL_PRIMARIES
</dt>
<dd>
<p>
        Additional single-file primaries.  (Builtin: HEADERS, SCRIPTS, DATA, MANS)
</p>
</dd>
<dt class="hdlist1">
AM_BIG_PRIMARIES
</dt>
<dd>
<p>
        Additional primaries built from objects.  (Builtin: PROGRAMS, LIBRARIES, LTLIBRARIES)
</p>
</dd>
<dt class="hdlist1">
AM_LANGUAGES
</dt>
<dd>
<p>
        Additional language names.  Antimake expects variables
        <tt>AM_LANG_$(name)_SRCEXTS</tt>, <tt>AM_LANG_$(name)_COMPILE</tt> and
        <tt>AM_LANG_$(name)_LINK</tt> to be set.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_variables_for_command_line_usage">Variables for command-line usage</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
DESTDIR
</dt>
<dd>
<p>
        Relocate installation root.
</p>
</dd>
<dt class="hdlist1">
AM_TRACE
</dt>
<dd>
<p>
        Turns on function-call debug info.  Can be set from command-line.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_hacking_variables">Hacking variables</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
GNUMAKE380, GNUMAKE381, GNUMAKE382
</dt>
<dd>
<p>
        If we have at least that version of GNU Make.  GNUMAKE380 is always
        set, others may not be.  If Makefile uses features from newer GNU Make
        it would be good idea to use those flags and error out with clear
        error message, instead having mysterious failures.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_libtool_flags">Libtool flags</h3>
<div class="paragraph"><p>Useful <a href="http://www.gnu.org/software/libtool/manual/html_node/Link-mode.html">Libtool</a>
flags that can be put int tgt_LDFLAGS for a LTLIBRARY:</p></div>
<div class="ulist"><ul>
<li>
<p>
-export-dynamic
</p>
</li>
<li>
<p>
-export-symbols symfile
</p>
</li>
<li>
<p>
-export-symbols-regex regex
</p>
</li>
<li>
<p>
-module
</p>
</li>
</ul></div>
<div class="paragraph"><p>See libtool <a href="http://www.gnu.org/software/libtool/manual/html_node/Versioning.html">"Versioning"</a> chapter about those:</p></div>
<div class="ulist"><ul>
<li>
<p>
-avoid-version
</p>
</li>
<li>
<p>
-version-info  current[:revision[:age]]
</p>
</li>
<li>
<p>
-version-number major[:minor[:revision]]
</p>
</li>
<li>
<p>
-release major[:minor[:revision]]
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_top_level_pseudo_targets">Top-level pseudo-targets</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_all">all</h3>
<div class="paragraph"><p>The default target when no other target is given on command-line.  Builds all target files.</p></div>
<div class="sect3">
<h4 id="_simple_targets">Simple targets</h4>
<div class="paragraph"><p>These are simple - either the file already exists,
or the user needs to give build command.</p></div>
</div>
<div class="sect3">
<h4 id="_object_based_targets">Object-based targets</h4>
<div class="paragraph"><p>The targets in primaries PROGRAMS, LIBRARIES and LTLIBRARIES consist of multiple source
files that need to be compiled into objects.  Then the objects need to be
linked into final target.  The process is roughly following:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Dependencies are built (_LDADD, _LIBADD, _DEPENDENCIES).
</p>
</li>
<li>
<p>
Source list is filtered for extensions that can be compiled into object files,
  object file list is created based on them.  The rest of files are used and
  dependencies for target, but otherwise ignored.
</p>
</li>
<li>
<p>
Object files are built.
</p>
</li>
<li>
<p>
Linker is picked based on source files - as there can be files in multiple languages,
  the most advanced language wins (the one that appears later in <tt>AM_LANGUAGES</tt>)
</p>
</li>
<li>
<p>
Final executable is linked.
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect2">
<h3 id="_install">install</h3>
<div class="paragraph"><p>Install all targets to their destination directories, which is mentioned
in their target list variable name.  Eg.  <tt>bin_PROGRAMS</tt> will be installed
to <tt>$(bindir)</tt>.   If destination is named <tt>noinst</tt>, it will not be installed.</p></div>
<div class="paragraph"><p>If the flag <tt>nobase</tt> is given, the relative filename is kept, otherwise
basename is taken and it will appear directly under destination directory.</p></div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre><tt>include_HEADERS = func1.h lib/func2.h
# Files will end up in:
#   $(includedir)/func1.h
#   $(includedir)/func2.h

nobase_include_HEADERS = func1.h lib/func2.h
# Files will end up in:
#   $(includedir)/func1.h
#   $(includedir)/lib/func2.h</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_clean">clean</h3>
<div class="ulist"><ul>
<li>
<p>
Remove files in <tt>$(CLEANFILES)</tt>
</p>
</li>
<li>
<p>
Remove built objects.
</p>
</li>
<li>
<p>
Remove target files, unless they are marked as <tt>dist</tt>.
  (Note: <tt>HEADERS</tt> primary is <tt>dist</tt> by default, all other are <tt>nodist</tt>)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_distclean">distclean</h3>
<div class="ulist"><ul>
<li>
<p>
Remove files in <tt>$(DISTCLEANFILES)</tt>
</p>
</li>
<li>
<p>
Remove sources tagged with <tt>nodist</tt>.  All sources as <tt>dist</tt> by default.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_maintainer_clean">maintainer-clean</h3>
<div class="ulist"><ul>
<li>
<p>
Remove files in <tt>$(MAINTAINERCLEANFILES)</tt>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_help">help</h3>
<div class="paragraph"><p>Describe top-level targets.</p></div>
</div>
<div class="sect2">
<h3 id="_am_test">am-test</h3>
<div class="paragraph"><p>Regression test for low-level Antimake functions.</p></div>
</div>
<div class="sect2">
<h3 id="_am_debug">am-debug</h3>
<div class="paragraph"><p>Show Antimake internal state.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features">FEATURES</h2>
<div class="sectionbody">
<div class="paragraph"><p>Done:</p></div>
<div class="ulist"><ul>
<li>
<p>
Big primaries: PROGRAMS, LIBRARIES, LTLIBRARIES
</p>
</li>
<li>
<p>
Small primaries: DATA, SCRIPTS, MANS, HEADERS
</p>
</li>
<li>
<p>
Flags: base nobase dist nodist noinst EXTRA
</p>
</li>
<li>
<p>
Target vars: SOURCES, CPPFLAGS, CFLAGS, LDFLAGS, LDADD/LIBADD
</p>
</li>
<li>
<p>
Separate build dir
</p>
</li>
<li>
<p>
Per-target objects
</p>
</li>
<li>
<p>
Languages: C, CXX
</p>
</li>
<li>
<p>
SUBDIRS, DIST_SUBDIRS
</p>
</li>
<li>
<p>
EMBED_SUBDIRS
</p>
</li>
</ul></div>
<div class="paragraph"><p>Todo:</p></div>
<div class="ulist"><ul>
<li>
<p>
Improve docs
</p>
</li>
<li>
<p>
Standardize and document how to extend
</p>
</li>
<li>
<p>
Deps with non-gcc?
</p>
</li>
<li>
<p>
Long if-s to support <tt>O=</tt> seems to break GNU Make 3.80.
  Drop <tt>O=</tt> or drop 3.80?
</p>
</li>
</ul></div>
<div class="paragraph"><p>Probably out of scope:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>make uninstall</tt>
</p>
</li>
<li>
<p>
<tt>make distcheck</tt>
</p>
</li>
<li>
<p>
<tt>make dist</tt> from separate build dir
</p>
</li>
<li>
<p>
<tt>install-(exec|data)-hook</tt> - based on dir not primary
</p>
</li>
<li>
<p>
Default file list for <tt>EXTRA_DIST</tt>.  (Problem: distclean / maintainer-clean)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Definitely out of scope:</p></div>
<div class="ulist"><ul>
<li>
<p>
automake conditionals
</p>
</li>
<li>
<p>
automake extras (autoconf macros, ltdl)
</p>
</li>
<li>
<p>
automake nanny mode (gnu/gnits)
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph"><p>GNU Make Reference: <a href="http://www.gnu.org/software/make/manual/make.html#Quick-Reference">http://www.gnu.org/software/make/manual/make.html#Quick-Reference</a></p></div>
<div class="paragraph"><p>Recursive Make Considered Harmful: <a href="http://miller.emu.id.au/pmiller/books/rmch/">http://miller.emu.id.au/pmiller/books/rmch/</a></p></div>
<div class="paragraph"><p>Paul&#8217;s Rules of Makefiles: <a href="http://make.mad-scientist.us/rules.html">http://make.mad-scientist.us/rules.html</a></p></div>
<div class="paragraph"><p>Small BSD-ish build system: <a href="https://webkeks.org/hg/buildsys/">https://webkeks.org/hg/buildsys/</a></p></div>
<div class="paragraph"><p>GNU Make Standard Library: <a href="http://sourceforge.net/projects/gmsl/">http://sourceforge.net/projects/gmsl/</a></p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>
